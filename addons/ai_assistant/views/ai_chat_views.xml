<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <!-- AI Chat Form View -->
    <record id="view_ai_chat_form" model="ir.ui.view">
        <field name="name">ai.chat.form</field>
        <field name="model">ai.chat</field>
        <field name="arch" type="xml">
            <form string="Chat v·ªõi AI">
                <sheet>
                    <div class="oe_title">
                        <label for="name" class="oe_edit_only"/>
                        <h1>
                            <field name="name" placeholder="T√™n cu·ªôc tr√≤ chuy·ªán..."/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="user_id" widget="many2one_avatar_user"/>
                            <field name="create_date" readonly="1"/>
                        </group>
                        <group>
                            <field name="message_count" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="üí¨ L·ªãch s·ª≠ tr√≤ chuy·ªán" name="messages">
                            <field name="message_ids" nolabel="1" mode="kanban,tree">
                                <kanban class="o_ai_message_kanban" create="0">
                                    <field name="role"/>
                                    <field name="content"/>
                                    <field name="create_date"/>
                                    <field name="is_error"/>
                                    <templates>
                                        <t t-name="kanban-box">
                                            <div t-attf-class="o_ai_bubble o_ai_role_#{record.role.raw_value} #{record.is_error.raw_value ? 'o_ai_error' : ''}">
                                                <div class="o_ai_msg_header">
                                                    <strong>
                                                        <t t-if="record.role.raw_value == 'user'">B·∫°n</t>
                                                        <t t-else="">AI Assistant</t>
                                                    </strong>
                                                    <small><field name="create_date"/></small>
                                                </div>
                                                <div class="o_ai_msg_content">
                                                    <field name="content"/>
                                                </div>
                                            </div>
                                        </t>
                                    </templates>
                                </kanban>
                                <tree decoration-info="role=='user'" decoration-success="role=='assistant'" decoration-danger="is_error==True" create="0" delete="1">
                                    <field name="create_date" string="Th·ªùi gian"/>
                                    <field name="role" string="Vai tr√≤"/>
                                    <field name="content" string="N·ªôi dung" widget="text"/>
                                    <field name="is_error" invisible="1"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <group>
                        <field name="new_message" placeholder="üí¨ Nh·∫≠p tin nh·∫Øn c·ªßa b·∫°n..." nolabel="1"/>
                    </group>
                    <button name="action_send_message" string="üì§ G·ª≠i" type="object" class="btn-primary"/>
                </footer>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- AI Chat Tree View -->
    <record id="view_ai_chat_tree" model="ir.ui.view">
        <field name="name">ai.chat.tree</field>
        <field name="model">ai.chat</field>
        <field name="arch" type="xml">
            <tree string="L·ªãch s·ª≠ chat" decoration-muted="message_count==0" decoration-bf="message_count>0">
                <field name="name" string="Cu·ªôc tr√≤ chuy·ªán"/>
                <field name="user_id" widget="many2one_avatar_user" string="Ng∆∞·ªùi d√πng"/>
                <field name="message_count" string="S·ªë tin nh·∫Øn"/>
                <field name="create_date" string="Ng√†y t·∫°o"/>
            </tree>
        </field>
    </record>

    <!-- AI Chat Search View -->
    <record id="view_ai_chat_search" model="ir.ui.view">
        <field name="name">ai.chat.search</field>
        <field name="model">ai.chat</field>
        <field name="arch" type="xml">
            <search string="T√¨m ki·∫øm cu·ªôc tr√≤ chuy·ªán">
                <field name="name" string="T√™n" filter_domain="[('name', 'ilike', self)]"/>
                <field name="user_id" string="Ng∆∞·ªùi d√πng"/>
                <filter string="Chat c·ªßa t√¥i" name="my_chats" domain="[('user_id', '=', uid)]"/>
                <filter string="C√≥ tin nh·∫Øn" name="has_messages" domain="[('message_count', '>', 0)]"/>
                <group expand="0" string="Nh√≥m theo">
                    <filter string="Ng∆∞·ªùi d√πng" name="group_user" context="{'group_by': 'user_id'}"/>
                    <filter string="Ng√†y t·∫°o" name="group_date" context="{'group_by': 'create_date'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action -->
    <record id="action_ai_chat" model="ir.actions.act_window">
        <field name="name">üí¨ L·ªãch s·ª≠ Chat AI</field>
        <field name="res_model">ai.chat</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_ai_chat_search"/>
        <field name="context">{'search_default_my_chats': 1, 'search_default_has_messages': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                üí¨ Ch∆∞a c√≥ cu·ªôc tr√≤ chuy·ªán n√†o
            </p>
            <p>
                B·∫Øt ƒë·∫ßu tr√≤ chuy·ªán v·ªõi AI Assistant ƒë·ªÉ nh·∫≠n h·ªó tr·ª£ v·ªÅ d·ª± √°n, nh√¢n s·ª± v√† c√¥ng vi·ªác.
            </p>
        </field>
    </record>

    <!-- Action to create new chat -->
    <record id="action_ai_new_chat" model="ir.actions.act_window">
        <field name="name">T·∫°o Chat m·ªõi</field>
        <field name="res_model">ai.chat</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
    </record>

    <!-- Extend Nh√¢n vi√™n Form - Add AI Tab -->
    <record id="view_nhan_vien_form_ai" model="ir.ui.view">
        <field name="name">nhan.vien.form.ai</field>
        <field name="model">nhan_vien</field>
        <field name="inherit_id" ref="nhan_su.view_nhan_vien_form"/>
        <field name="arch" type="xml">
            <!-- Add AI buttons -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_ai_danh_gia" type="object" class="oe_stat_button" icon="fa-star" string="AI ƒê√°nh gi√°"/>
                <button name="action_ai_goi_y_dao_tao" type="object" class="oe_stat_button" icon="fa-graduation-cap" string="AI ƒê√†o t·∫°o"/>
            </xpath>
            
            <!-- Add AI Tab -->
            <xpath expr="//page[@name='ghi_chu']" position="after">
                <page string="AI Assistant" name="ai_assistant">
                    <group>
                        <field name="ai_updated"/>
                    </group>
                    <group string="ƒê√°nh gi√° t·ª´ AI">
                        <field name="ai_danh_gia" nolabel="1"/>
                    </group>
                    <group string="G·ª£i √Ω ƒë√†o t·∫°o t·ª´ AI">
                        <field name="ai_goi_y_dao_tao" nolabel="1"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Extend D·ª± √°n Form - Add AI Tab -->
    <record id="view_du_an_form_ai" model="ir.ui.view">
        <field name="name">du.an.form.ai</field>
        <field name="model">du_an</field>
        <field name="inherit_id" ref="quan_ly_du_an.view_du_an_form"/>
        <field name="arch" type="xml">
            <!-- Add AI buttons -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_ai_phan_tich_rui_ro" type="object" class="oe_stat_button" icon="fa-warning" string="AI R·ªßi ro"/>
                <button name="action_ai_goi_y_timeline" type="object" class="oe_stat_button" icon="fa-calendar" string="AI Timeline"/>
                <button name="action_ai_tom_tat" type="object" class="oe_stat_button" icon="fa-file-text" string="AI T√≥m t·∫Øt"/>
            </xpath>
            
            <!-- Add AI Tab -->
            <xpath expr="//page[@name='ghi_chu']" position="after">
                <page string="AI Assistant" name="ai_assistant">
                    <group>
                        <field name="ai_updated"/>
                    </group>
                    <group string="Ph√¢n t√≠ch r·ªßi ro AI">
                        <field name="ai_phan_tich_rui_ro" nolabel="1"/>
                    </group>
                    <group string="G·ª£i √Ω Timeline AI">
                        <field name="ai_goi_y_timeline" nolabel="1"/>
                    </group>
                    <group string="T√≥m t·∫Øt d·ª± √°n AI">
                        <field name="ai_tom_tat" nolabel="1"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Extend C√¥ng vi·ªác Form - Add AI Tab -->
    <record id="view_cong_viec_form_ai" model="ir.ui.view">
        <field name="name">cong.viec.form.ai</field>
        <field name="model">cong_viec</field>
        <field name="inherit_id" ref="quan_ly_cong_viec.view_cong_viec_form"/>
        <field name="arch" type="xml">
            <!-- Add AI buttons -->
            <xpath expr="//div[@name='button_box']" position="inside">
                <button name="action_ai_uoc_tinh_thoi_gian" type="object" class="oe_stat_button" icon="fa-clock-o" string="AI Th·ªùi gian"/>
                <button name="action_ai_goi_y_thuc_hien" type="object" class="oe_stat_button" icon="fa-lightbulb-o" string="AI G·ª£i √Ω"/>
                <button name="action_ai_tao_checklist" type="object" class="oe_stat_button" icon="fa-list-ul" string="AI Checklist"/>
            </xpath>
            
            <!-- Add AI Tab -->
            <xpath expr="//page[@name='khac']" position="after">
                <page string="AI Assistant" name="ai_assistant">
                    <group>
                        <field name="ai_updated"/>
                    </group>
                    <group string="∆Ø·ªõc t√≠nh th·ªùi gian AI">
                        <field name="ai_uoc_tinh_thoi_gian" nolabel="1"/>
                    </group>
                    <group string="G·ª£i √Ω th·ª±c hi·ªán AI">
                        <field name="ai_goi_y_thuc_hien" nolabel="1"/>
                    </group>
                    <group string="M√¥ t·∫£ t·ª± ƒë·ªông (AI t·∫°o)">
                        <field name="ai_mo_ta_tu_dong" nolabel="1"/>
                    </group>
                </page>
            </xpath>
        </field>
    </record>
</odoo>
